FROM debian:bullseye

RUN apt update -y 
RUN apt upgrade -y
RUN apt install mariadb-server -y 
RUN apt install vim -y

# COPY THE MARIADB CONFIGURATION FILE :
# THIS FILE CONTAINS MODIFIED DATA TO CONFIG OUR MARIADB SERVER
# WE HAVE TO COPY IT TO THE MARIADB CONFIGURATION DIRECTORY BEFORE RUNNING THE MYSQL SERVICE
# BECAUSE MARIADB WILL NE RUNNING WITH THE SOCKET AT LOCATION
# /run/mysql/mysql.sock
COPY conf/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf

# COPY THE INIT SQL SCRIPT CONFIGURATION FILE 
# INSIDE ETC/MYSQL DIR DURING THE BUILD PROCESS
COPY tools/init.sql /etc/mysql/init.sql

# CREATE THE DIRECTORY FOR THE MYSQL SOCKET
RUN mkdir /run/mysqld

# REPLACE MYSQLD_SAFE COMMAND BY MYSQLD SO WE ACTUALLY HAVE MORE DEBUG INFORMATION
CMD ["mysqld"]